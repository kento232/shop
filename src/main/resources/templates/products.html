<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${product != null ? product.productName : '商品詳細'}">商品詳細</title>
  <link th:href="@{/css/products.css}" rel="stylesheet" href="products.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --maxw: 1080px; --gap: 16px; --border: #e5e7eb; --muted:#6b7280; --primary:#0ea5e9; --bg:#ffffff; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', 'Yu Gothic UI', 'Meiryo', sans-serif; margin:0; color:#111827; background:var(--bg); }
    header, main { max-width: var(--maxw); margin: 0 auto; padding: 16px; }
    a { color: var(--primary); text-decoration: none; }
    .muted { color: var(--muted); }
    .wrap { display:grid; grid-template-columns: 1fr 1fr; gap:24px; }
    .thumb { aspect-ratio:4/3; background:#f3f4f6; border:1px solid var(--border); border-radius:12px; display:flex; align-items:center; justify-content:center; }
    .thumb img { max-width:100%; max-height:100%; object-fit:contain; }
    .d-name { font-size:22px; margin:0 0 8px; }
    .sku { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .d-price { display:flex; align-items:baseline; gap:8px; margin: 8px 0 16px; }
    .d-price s { color: var(--muted); }
    .d-price strong { font-size: 22px; }
    .pill { font-size:12px; color:#fff; background:#10b981; padding:2px 6px; border-radius:999px; }
    .props { border-top:1px solid var(--border); margin-top: 16px; padding-top: 16px; }
    .props dl { display:grid; grid-template-columns: 140px 1fr; gap: 8px 16px; }
    .props dt { color:#374151; }
    .props dd { margin: 0; }
    @media (max-width: 860px) { .wrap { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
<div th:replace="~{header :: header}"></div>
<header>
  <!-- 一覧ページをまだ作らない場合は /top へ戻すのが自然 -->
  <a href="/top">← トップへ戻る</a>
</header>

<!-- 詳細表示 -->
<main th:if="${product != null}">
  <div class="wrap">
    <div class="thumb">
      <img th:if="${product.productImage != null}"
           th:src="@{/images/products/{img}(img=${product.productImage})}"
           th:alt="${product.productName}">
      <div th:if="${product.productImage == null}" class="muted">No Image</div>
    </div>

    <section>
      <h1 class="d-name" th:text="${product.productName}">商品名</h1>
      <div class="sku">商品ID：<span th:text="${product.productId}">0000-000000</span></div>

      <div class="d-price">
        <span th:if="${product.productDiscountPrice != null and product.productDiscountPrice > 0}">
          <s th:text="${#numbers.formatInteger(product.productPrice, 3, 'COMMA')}">39,900</s>
        </span>
        <!-- 割引 > 0 のとき割引価格、なければ通常価格 -->
        <strong th:text="${#numbers.formatInteger(
           (product.productDiscountPrice != null and product.productDiscountPrice > 0) ? product.productDiscountPrice : product.productPrice
          , 3, 'COMMA')}">3,990</strong><span>円</span>
        <span class="pill" th:if="${product.productDiscountPrice != null and product.productDiscountPrice > 0}">SALE</span>
      </div>

<button type="submit" class="btn btn-primary" id="addToCartBtn" aria-label="カートに追加">
            カートに追加
          </button>

      <div class="props">
        <dl>
          <dt>カテゴリID</dt><dd th:text="${product.categoryId}">—</dd>
          <dt>サブカテゴリID</dt><dd th:text="${product.subcategoryId}">—</dd>
          <dt>サイズ</dt><dd th:text="${product.productSize}">—</dd>
          <dt>カラー</dt><dd th:text="${product.productColor}">—</dd>
          <dt>素材</dt><dd th:text="${product.productMaterial}">—</dd>
          <dt>重量</dt><dd th:text="${product.productWeight}">—</dd>
          <dt>梱包サイズ</dt><dd th:text="${product.productPackingSize}">—</dd>
          <dt>生産国</dt><dd th:text="${product.productManufacture}">—</dd>
          <dt>販売期間</dt>
          <dd>
            <span th:text="${product.productSaleStartDay}">—</span>
            <span> 〜 </span>
            <span th:text="${product.productSaleStopDay != null ? product.productSaleStopDay : '（未設定）'}">（未設定）</span>
          </dd>
          <dt>コメント</dt><dd th:text="${product.comment}">—</dd>
        </dl>
      </div>
    </section>
  </div>

  <p class="muted" style="margin-top:24px;">
    表示条件：公開フラグ=1、販売開始日≦本日、販売終了日が未設定または≧本日
  </p>
</main>

<!-- フォールバック（万一 product が null の場合） -->
<main th:if="${product == null}">
  <p class="muted">商品データを取得できませんでした。</p>
  <a href="/top">← トップへ戻る</a>
</main>

</body>
</html>