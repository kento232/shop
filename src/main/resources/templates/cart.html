<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>カート | KEN INTERIOR SHOP</title>

	<meta name="_csrf" th:content="${_csrf.token}" />
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />


	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/cart.css}">
	<link rel="stylesheet" th:href="@{/css/footer.css}">
	<!-- 数量変更用JS -->
	<script defer th:src="@{/js/cart-badge.js}"></script>
	<script defer th:src="@{/js/cart.js}"></script>
</head>

<body>

	<!-- ヘッダー差し込み -->
	<div th:replace="~{header :: header}"></div>

	<main class="container">
		<div class="page-top">
			<h1 class="page-title">カート詳細</h1>
			<button class="back-btn" type="button" onclick="location.href='/'">トップ画面に戻る</button>
		</div>

		<div class="notice" th:if="${needLogin}">
			購入するためにはログイン、もしくは会員登録が必要です。
		</div>

		<div class="layout">
			<section class="list">

				<!-- items が空のとき -->
				<p class="empty" th:if="${items == null || #lists.isEmpty(items)}">
					カートに商品がありません。
				</p>



				<div class="item" th:each="it : ${items}" th:attr="data-product-id=${it.productId}">
					<div class="thumb">
						<img th:src="@{'/images/products/' + ${it.productImage}}" alt="${it.productName}">
					</div>

					<div class="item-main">
						<p class="item-name" th:text="${it.productName}">商品名</p>

						<div class="controls">
							<div class="qty">
								
								<select class="js-cart-qty">
									<option th:each="n : ${#numbers.sequence(1,10)}" th:value="${n}" th:text="${n}"
										th:selected="${n} == ${it.qty}">
									</option>
								</select>
								<span class="unit">個</span>
							</div>

							<!-- 既存の削除フォームはそのまま -->
							<form th:action="@{/cart/delete}" method="post">
								<input type="hidden" name="productId" th:value="${it.productId}">
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
								<button class="delete-btn" type="submit">カートから削除</button>
							</form>
						</div>
					</div>

					<div class="item-price">
						<span class="unit-price" th:text="${#numbers.formatInteger(it.price, 1, 'COMMA')}">0</span> 円
					</div>

					<!-- （任意）行小計を見せたいなら追加 -->
					<div class="item-subtotal">
						小計：<span class="line-subtotal" th:text="${it.price * it.qty}">0</span> 円
					</div>
				</div>
			</section>

			<aside class="side">
				<div class="side-card">
					<!-- サマリー（JSで更新するのでID付与） -->
					<div class="summary">
						<div>小計：<span id="summary-subtotal" th:text="${subtotal}">0</span> 円</div>
						<div>送料：<span id="summary-shipping" th:text="${shipping}">0</span> 円</div>
						<div>合計：<strong id="summary-total" th:text="${total}">0</strong> 円</div>
					</div>
					<a class="btn btn--primary" href="/order/confirm">購入に進む</a>
				</div>
			</aside>
		</div>


	</main>
	<div th:replace="~{footer :: footer}"></div>
</body>

</html>